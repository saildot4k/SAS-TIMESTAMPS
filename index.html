<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SAS-TimeStamps API</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;line-height:1.4;
         margin:2rem;max-width:800px}
    .card{padding:1rem;border:1px solid #ddd;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    input[type=text]{width:100%;padding:.6rem .8rem;border:1px solid #ccc;border-radius:8px}
    button{padding:.6rem 1rem;border:0;border-radius:8px;background:#111;color:#fff;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    pre{background:#f7f7f8;padding:1rem;border-radius:12px;overflow:auto}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <h1>SAS-TimeStamps API</h1>
  <h2>from the SAS/UMCS Team @ <a href="https://ps2store.com">PS2 HomeBrew Store</a></h2>
  <p>This page registers a Service Worker that exposes a JSON endpoint at <code>/api?name=&lt;FOLDER&gt;</code>.</p>
  <div class="card">
    <p><b>Try it</b> (after the service worker is ready):</p>
    <input id="name" type="text" placeholder="e.g. SYS_CONF or BOOT or APP_WLE-ISR-XF-MM" />
    <div style="margin-top:.6rem;display:flex;gap:.5rem">
      <button id="btn" disabled>Query API</button>
      <span id="status">Installing service worker…</span>
    </div>
    <pre id="out" style="margin-top:1rem">—</pre>
  </div>

  <script>
    const swUrl = 'sw.js';
    async function waitForController() {
      if (navigator.serviceWorker.controller) return;
      await new Promise(resolve => {
        navigator.serviceWorker.addEventListener('controllerchange', () => resolve(), { once: true });
      });
    }
    (async function init() {
      if ('serviceWorker' in navigator) {
        try {
          const reg = await navigator.serviceWorker.register(swUrl, { scope: './' });
          await reg.update();
          await waitForController();
          document.getElementById('status').textContent = 'Service worker ready.';
          document.getElementById('btn').disabled = false;
        } catch (e) {
          document.getElementById('status').textContent = 'SW registration failed: ' + e;
        }
      } else {
        document.getElementById('status').textContent = 'Service workers not supported in this browser.';
      }

      document.getElementById('btn').addEventListener('click', async () => {
        const name = document.getElementById('name').value.trim();
        const url = new URL('./api', location.href);
        url.searchParams.set('name', name);
        const res = await fetch(url.toString(), { cache: 'no-store' });
        const txt = await res.text();
        document.getElementById('out').textContent = txt;
      });
    })();
  </script>
</body>
</html>
